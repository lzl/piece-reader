<template name="reader">
  <div class="row">
    {{> readerForm}}
    <div class="hr"></div>
  </div>

  {{#if currentUser}}
    <div class="row">
      {{#readerClonesWrapper}}
        {{> readerSubsWrapper}}
      {{/readerClonesWrapper}}
    </div>
  {{else}}
    <div class="row">
      {{> readerDemo}}
    </div>
  {{/if}}
</template>

<template name="readerForm">
  <form id="subscribe" class="form-inline">
    <div class="form-group">
      <label class="sr-only" for="url">URL</label>
      <input type="text" class="form-control" id="url" name="url" placeholder="URL" required>
    </div>
    <div class="form-group">
      <label class="sr-only" for="userId">User ID</label>
      <input type="text" class="form-control" id="userId" name="userId" placeholder="User ID" required>
    </div>
    <button type="submit" class="btn btn-primary">Follow</button>
  </form>
</template>

<template name="readerClonesWrapper">
  {{#if Template.subscriptionsReady}}
    {{> Template.contentBlock}}
  {{/if}}
</template>

<template name="readerSubsWrapper">
  {{#if Template.subscriptionsReady}}
    {{#if hasSub}}
      {{> Template.dynamic template=card}}
    {{else}}
      <ul class="list-group">
        <li class="list-group-item">You have no following.</li>
      </ul>
    {{/if}}
  {{else}}
    <ul class="list-group">
      <li class="list-group-item">Loading...</li>
    </ul>
  {{/if}}
</template>

<template name="readerPiecesWrapper">
  {{#if hasPiece}}
    {{#each pieces}}
      {{> readerPiece}}
    {{/each}}
  {{else}}
    <ul class="list-group">
      <li class="list-group-item">Fetching...</li>
    </ul>
  {{/if}}
</template>

<template name="readerPiece">
  <div class="card card-block">
    <p class="card-text">
      <strong>{{owner}}</strong>
      <small class="text-muted">({{ownerId}})</small>
    </p>
    <p class="card-text">
      {{content}}
    </p>
    <p class="card-text">
      <small class="text-muted">Piece ID: {{_id}}</small>
    </p>
  </div>
</template>

<template name="readerDemo">
  <div class="jumbotron">
    <h1 class="display-2">Welcome to Piece Reader.</h1>
    <p class="lead">Each piece is a message. You can follow other's pieces at top form &#8593; or you can create an account at top-left corner ↖ to remember your following.</p>

    <p class="lead"><mark>Example</mark> URL: <code>https://piece.meteor.com</code> User ID: <code>492WZqeqCxrDqfG5u</code> <button type="button" class="btn btn-secondary btn-sm" data-action="subscribe">1-Click follow</button></p>

    {{#if subscribed}}
      <hr class="m-y-md">
      <p>Thank you for trying. Pieces will be shown below ↓ in a few seconds. For more, you can create your account to follow other's pieces if you know its URL and User ID. When you come back next time, Piece Reader will remember who you followed. Want to publish your own pieces? Check out <a href="https://piece.meteor.com/">Piece</a>.</p>
    {{/if}}
  </div>

  {{#each pieces}}
    {{> readerPiece}}
  {{/each}}
</template>
