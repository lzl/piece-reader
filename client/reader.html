<template name="reader">
  <div class="row">
    {{> readerForm}}
    <div class="hr"></div>
  </div>

  {{#if currentUser}}
    <div class="row">
      {{#clonesWrapper}}
        {{#subsWrapper}}
          {{> dynamicSubs}}
        {{/subsWrapper}}
      {{/clonesWrapper}}
    </div>
  {{else}}
    <div class="row">
      {{> readerPiecesDemo}}
    </div>
  {{/if}}
</template>

<template name="readerForm">
  <form id="subscribe" class="form-inline">
    <div class="form-group">
      <label class="sr-only" for="url">URL</label>
      <input type="text" class="form-control" id="url" name="url" placeholder="URL" required>
    </div>
    <div class="form-group">
      <label class="sr-only" for="userId">User ID</label>
      <input type="text" class="form-control" id="userId" name="userId" placeholder="User ID" required>
    </div>
    <button type="submit" class="btn btn-primary">Preview</button>
  </form>
</template>

<template name="dynamicSubs">
  {{#if hasSub}}
    {{> Template.dynamic template=card}}
  {{else}}
    <ul class="list-group">
      <li class="list-group-item">You have no following.</li>
    </ul>
  {{/if}}
</template>

<template name="readerPieces">
  {{#if hasPiece}}
    {{#each pieces}}
      {{> readerPiece}}
    {{/each}}
  {{else}}
    <ul class="list-group">
      <li class="list-group-item">Fetching pieces...</li>
    </ul>
  {{/if}}
</template>

<template name="readerPiece">
  <div class="card card-block">
    <p class="card-text">
      <strong>{{owner}}</strong>
      <small class="text-muted">({{ownerId}})</small>
    </p>
    <p class="card-text">
      {{content}}
    </p>
    <p class="card-text">
      <small class="text-muted">Piece ID: {{_id}}</small>
    </p>
  </div>
</template>

<template name="readerPiecesDemo">
  <div class="jumbotron">
    <h1 class="display-2">Welcome to Piece Reader.</h1>
    <p class="lead">Each piece is a message. You can preview pieces with top form &#8593;.</p>
    <p>Below &#8595; is Piece's official pieces, for demonstration.</p>
    <p>For more, you can create an account to follow other's pieces if you know its URL and User ID. When you come back next time, Piece Reader will remember who you followed. Want to publish your own pieces? Check out <a href="https://piece.meteor.com/">Piece</a>.</p>
  </div>

  {{#if hasPiece}}
    {{#each pieces}}
      {{> readerPiece}}
    {{/each}}
  {{else}}
    <ul class="list-group">
      <li class="list-group-item">Fetching demo pieces...</li>
    </ul>
  {{/if}}
</template>
